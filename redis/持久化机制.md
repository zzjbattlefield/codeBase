<font size="4">

# Redis持久化的原理及优化

Redis为持久化提供了两种方式：

1. RDB：在指定的时间间隔能对你的数据进行快照存储。
1. AOF：记录每次对服务器写的操作,当服务器重启的时候会重新执行这些命令来恢复原始的数据。

## RDB的持久化配置
```sh
# 时间策略
save 900 1 # 表示900s内如果有1条是写入命令，就触发产生一次快照，可以理解为就进行一次备份
save 300 10
save 60 10000
save "" # 禁用RDB
# 文件名称
dbfilename dump.rdb

# 文件保存路径
dir /home/work/app/redis/data/

# 如果持久化出错，主进程是否停止写入
stop-writes-on-bgsave-error yes

# 是否压缩
rdbcompression yes

# 导入时是否检查
rdbchecksum yes
```

## AOF配置
```sh
# 是否开启aof
appendonly yes

# 文件名称
appendfilename "appendonly.aof"

# 同步方式
appendfsync everysec #always everysec no

# aof重写期间是否同步
no-appendfsync-on-rewrite no

# 重写触发配置
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# 加载aof时如果有错如何处理
aof-load-truncated yes

# 文件重写策略
aof-rewrite-incremental-fsync yes
```
appendfsync everysec 它其实有三种模式:
1. always 每一条命令都同步
1. everysec 每秒同步一次
1. no redis不处理交给OS来处理，非常快，但是也最不安全
